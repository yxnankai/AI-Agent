# AI智能体项目完整说明

## 🎯 项目概述

基于Ollama的AI智能体软件，具备天气信息获取、热点新闻聚合、AI智能汇总等功能，支持地域相关性分析和个性化推荐。

## 🚀 核心功能

### 1. 天气信息获取
- **实时天气数据**: 通过wttr.in API获取全球天气信息
- **多城市支持**: 支持100+中国主要城市
- **详细信息**: 温度、湿度、风速、风向、能见度、气压等
- **智能解析**: 自动处理API数据结构，确保显示正常

### 2. 热点新闻聚合
- **新闻源**: 新浪新闻API实时获取热点新闻
- **地域相关性**: 智能分析新闻与指定城市的相关性
- **关键词匹配**: 支持20个主要城市的关键词映射
- **可点击链接**: 新闻标题支持点击跳转到原文

### 3. AI智能汇总
- **Ollama集成**: 支持多种大语言模型
- **模型管理**: 自动识别和选择可用模型
- **思维链优化**: 去除冗余的思考过程，输出简洁直接
- **地域定制**: 根据城市筛选相关新闻进行汇总

### 4. 用户界面
- **现代化设计**: Bootstrap响应式界面
- **城市选择**: 智能城市搜索和自动完成
- **模型选择**: 下拉菜单选择Ollama模型
- **实时反馈**: Toast通知系统

## 🔧 技术架构

### 后端技术栈
- **Flask**: Python Web框架
- **Requests**: HTTP请求库
- **Ollama**: 本地大语言模型推理
- **JSON**: 数据交换格式

### 前端技术栈
- **HTML5/CSS3**: 页面结构和样式
- **JavaScript**: 交互逻辑
- **Bootstrap**: 响应式UI框架
- **Markdown**: 内容渲染

### 核心模块
```
services/
├── weather_service.py    # 天气服务
├── news_service.py       # 新闻服务
└── ollama_service.py     # AI汇总服务
```

## 📊 功能特性

### 1. 地域相关性分析
**支持城市**: 北京、上海、广州、深圳、杭州、南京、成都、重庆、武汉、西安、天津、青岛、大连、厦门、苏州、无锡、宁波、长沙、郑州、济南

**关键词映射示例**:
- 北京: 北京、首都、京津冀、华北、中关村、望京、朝阳、海淀
- 上海: 上海、魔都、长三角、华东、浦东、黄浦、徐汇、静安
- 广州: 广州、羊城、珠三角、华南、天河、越秀、荔湾、海珠

**相关性算法**:
```python
# 相关性分数计算
score = 0
for keyword in city_keywords:
    if keyword.lower() in title.lower():
        score += 2  # 标题匹配权重更高
    if keyword.lower() in summary.lower():
        score += 1  # 摘要匹配权重较低
```

### 2. AI汇总优化
**思维链删除**: 去除"根据以上信息"、"基于天气和新闻"等表述

**输出格式**:
```markdown
# AI智能汇总报告

## 今日天气概况
北京今日天气多云，气温28°C，湿度79%，风速9km/h。

## 热点新闻聚焦（北京相关）
• 北京科技创新中心建设加速推进
• 北京中关村科技园区发展新动态

## 生活工作建议
根据北京天气情况合理安排出行，关注本地热点新闻动态。
```

### 3. 天气数据解析
**安全解析策略**:
- 优先级1: 中文描述 (`lang_zh`)
- 优先级2: 英文描述 (`weatherDesc`)
- 优先级3: 图标URL解析
- 默认值: '多云'

**数据类型保证**: 所有字段确保为字符串类型

## 🛠️ 安装部署

### 环境要求
- Python 3.7+
- Ollama (本地大语言模型)
- 网络连接 (API访问)

### 快速安装
```bash
# 1. 克隆项目
git clone <repository-url>
cd AI-Agent

# 2. 安装依赖
pip install -r requirements.txt

# 3. 安装Ollama
# Windows: 下载安装包
# Linux/Mac: curl -fsSL https://ollama.ai/install.sh | sh

# 4. 下载模型
ollama pull qwen:latest

# 5. 启动应用
python run.py
```

### 一键启动
```bash
# Windows
start_ai.bat

# 或使用Python启动器
python start_ai.py
```

## 📱 使用指南

### 1. 基本操作
1. 打开浏览器访问 `http://localhost:5000`
2. 选择城市或输入城市名称
3. 选择Ollama模型
4. 点击"获取AI汇总"按钮

### 2. 功能说明
- **天气查询**: 实时获取指定城市天气信息
- **新闻浏览**: 查看热点新闻，支持点击跳转
- **AI汇总**: 生成包含天气和新闻的智能汇总报告
- **地域筛选**: 自动筛选与城市相关的新闻

### 3. 高级功能
- **模型切换**: 支持多种Ollama模型
- **城市搜索**: 智能城市名称匹配
- **实时更新**: 自动刷新天气和新闻数据

## 🔍 故障排除

### 常见问题

#### 1. Ollama连接失败
```bash
# 检查Ollama服务
ollama list

# 启动Ollama服务
ollama serve
```

#### 2. 天气数据异常
- 检查网络连接
- 验证城市名称
- 查看API响应

#### 3. 新闻获取失败
- 检查新浪新闻API状态
- 验证网络连接
- 查看错误日志

### 调试工具
```bash
# 测试服务
python test_services.py

# 测试天气修复
python test_weather_fix.py

# 测试地域相关性
python test_relevance_analysis.py
```

## 📈 项目亮点

### 1. 技术创新
- **智能地域分析**: 自动识别新闻与城市相关性
- **思维链优化**: 去除AI输出中的冗余信息
- **安全数据解析**: 处理复杂的API数据结构

### 2. 用户体验
- **一键启动**: 自动环境检查和依赖安装
- **智能提示**: Toast通知和错误反馈
- **响应式设计**: 适配各种设备屏幕

### 3. 代码质量
- **模块化设计**: 清晰的服务分离
- **错误处理**: 完善的异常处理机制
- **测试覆盖**: 全面的功能测试

## 🎯 应用场景

### 1. 个人用户
- 日常天气查询
- 热点新闻浏览
- 智能信息汇总

### 2. 商务用户
- 市场动态监控
- 地域信息分析
- 决策支持工具

### 3. 开发者
- AI应用开发参考
- API集成示例
- 前端交互设计

## 📝 开发说明

### 项目结构
```
AI-Agent/
├── app.py                 # Flask主应用
├── run.py                 # 启动脚本
├── config.py              # 配置文件
├── services/              # 服务模块
│   ├── weather_service.py
│   ├── news_service.py
│   └── ollama_service.py
├── templates/             # 前端模板
│   └── index.html
├── requirements.txt       # 依赖列表
└── README.md             # 项目说明
```

### API接口
- `GET /` - 主页面
- `GET /api/weather?city=<city>` - 获取天气信息
- `GET /api/news` - 获取热点新闻
- `GET /api/summary?city=<city>` - 获取AI汇总
- `GET /api/cities` - 获取支持的城市列表
- `GET /api/models` - 获取可用的Ollama模型
- `POST /api/set-model` - 设置当前模型

### 配置选项
```python
# config.py
FLASK_DEBUG = True
OLLAMA_HOST = 'http://localhost:11434'
OLLAMA_MODEL = 'qwen:latest'
WEATHER_API_TIMEOUT = 10
NEWS_LIMIT = 10
```

## 🚀 未来规划

### 1. 功能扩展
- 支持更多新闻源
- 增加天气预警功能
- 添加历史数据查询

### 2. 技术优化
- 引入缓存机制
- 优化API响应速度
- 增强错误处理

### 3. 用户体验
- 移动端适配
- 多语言支持
- 个性化设置

## 📄 许可证

本项目采用MIT许可证，详见LICENSE文件。

## 🤝 贡献指南

欢迎提交Issue和Pull Request来改进项目。

---

**AI智能体** - 让信息获取更智能、更便捷！🚀 