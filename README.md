# AI智能体 - 天气新闻汇总系统

基于Ollama的AI智能体软件，具备天气信息获取、热点新闻聚合、AI智能汇总等功能，支持地域相关性分析和新闻讨论。

## ✨ 主要功能

### 🌤️ 天气信息获取
- 实时获取全球天气数据
- 支持100+中国主要城市
- 显示温度、湿度、风速等详细信息
- **地区标注显示，清晰标识信息所属城市**

### 📰 新闻获取与智能排序
- 获取实时热点新闻
- **按城市相关程度自动排序**
- **每条新闻显示相关程度标签**
- **地区标注显示，明确标识新闻所属地区**
- 支持20个主要城市的关键词匹配
- 相关程度：高度相关🔥、相关⭐、一般相关📌、一般🔗

### 💬 新闻讨论功能 ⭐ 新功能
- **与AI讨论特定新闻**
- **自动抓取新闻网页内容**
- **基于新闻内容进行深度分析**
- **支持持续性对话和对话历史管理**
- **基于前序问答进行补充和深化**
- **删除思考过程，直接输出结果**
- 支持影响分析、原因分析、趋势预测等问题类型

### 🤖 AI智能汇总
- 结合天气和新闻信息生成汇总报告
- 支持Markdown格式输出
- 去除思维链信息，提供简洁明了的分析
- **地区标注显示，明确标识汇总所属城市**
- **字符串匹配过滤，去除<think>标签和思考关键词**

### 🔄 自动刷新功能 ⭐ 新功能
- **地区更新后自动刷新所有信息**
- **并行获取天气、新闻和AI汇总**
- **支持回车键快速切换城市**
- **页面加载时自动加载默认城市信息**

### 🧠 思考内容过滤功能 ⭐ 新功能
- **字符串匹配过滤，去除AI回复中的思考内容**
- **支持<think>和<thinking>标签过滤**
- **过滤常见思考关键词和过渡语句**
- **应用于AI汇总和新闻讨论功能**
- **保持内容完整性，只去除思考过程**

## 🚀 快速开始

### 环境要求
- Python 3.8+
- Ollama (本地大语言模型)
- 网络连接

### 安装步骤
1. 克隆项目
2. 安装依赖：`pip install -r requirements.txt`
3. 安装Ollama：运行 `install_ollama.bat`
4. 启动应用：`python app.py`

### 一键启动
```bash
# 使用启动脚本
python start_ai.py

# 或直接启动
python app.py
```

## 📖 使用说明

### 基本使用
1. 打开浏览器访问 `http://localhost:5000`
2. 输入城市名称（支持自动补全）
3. 选择Ollama模型
4. 点击"生成AI汇总"获取报告
5. **地区更新后会自动刷新所有信息**

### 自动刷新功能
1. **输入城市名称**：在输入框中输入或选择城市
2. **回车键确认**：按回车键快速切换城市
3. **自动刷新**：系统会自动并行获取该城市的天气、新闻和AI汇总
4. **实时反馈**：显示更新进度和结果状态
5. **地区标注**：所有信息都会显示所属城市标识

### 新闻讨论功能
1. 在新闻列表中找到感兴趣的新闻
2. 点击新闻旁的"💬"按钮
3. 在弹出的对话框中输入问题
4. 点击"提交讨论"获取AI回复
5. **可以继续提问，AI会基于前序对话进行补充**
6. **支持查看对话历史和清除历史记录**

### 相关程度说明
- 🔥 **高度相关**: 与指定城市高度相关的新闻
- ⭐ **相关**: 与指定城市相关的新闻  
- 📌 **一般相关**: 与指定城市有一定相关性的新闻
- 🔗 **一般**: 普通新闻

## 🔧 技术架构

### 后端技术栈
- **Flask**: Web框架
- **Ollama**: 本地大语言模型推理
- **requests**: HTTP请求库
- **BeautifulSoup4**: 网页内容解析
- **wttr.in**: 天气API
- **新浪新闻API**: 新闻数据源

### 前端技术栈
- **HTML5/CSS3**: 页面结构
- **Bootstrap 5**: UI框架
- **JavaScript**: 交互逻辑
- **Font Awesome**: 图标库

## 📊 功能特性

### 新闻相关程度算法
1. **关键词匹配**: 基于城市关键词库进行匹配
2. **权重分配**: 
   - 标题匹配: 3分
   - 摘要匹配: 1分
3. **相关级别划分**:
   - 高度相关: ≥6分
   - 相关: ≥3分
   - 一般相关: ≥1分
   - 一般: 0分

### 支持的城市
北京、上海、广州、深圳、杭州、南京、成都、重庆、武汉、西安、天津、青岛、大连、厦门、苏州、无锡、宁波、长沙、郑州、济南

## 🛠️ 故障排除

### 常见问题
1. **Ollama连接失败**: 检查Ollama服务是否启动
2. **新闻获取失败**: 检查网络连接
3. **内容抓取失败**: 某些网站可能有反爬虫机制
4. **模型加载失败**: 检查Ollama模型是否已下载

### 解决方案
- 查看控制台错误信息
- 检查网络连接
- 重启Ollama服务
- 尝试不同的新闻链接

## 📁 项目结构
```
AI-Agent/
├── app.py                 # Flask主应用
├── services/              # 服务模块
│   ├── news_service.py    # 新闻服务
│   ├── ollama_service.py  # AI服务
│   └── weather_service.py # 天气服务
├── templates/             # 前端模板
│   └── index.html         # 主页面
├── requirements.txt       # 依赖列表
├── start_ai.py           # 启动脚本
└── README.md             # 项目说明
```

## 📝 更新日志

### v2.0 (最新版本)
- ✅ 新增新闻讨论功能
- ✅ 新增新闻相关程度标注
- ✅ 新增新闻按相关程度排序
- ✅ 新增新闻内容自动抓取
- ✅ 优化AI回复质量
- ✅ 改进用户界面

### v1.0
- ✅ 基础天气查询功能
- ✅ 基础新闻获取功能
- ✅ AI汇总功能
- ✅ 模型选择功能

## 🎯 技术特色

1. **智能排序**: 基于城市相关程度的新闻智能排序
2. **内容抓取**: 自动抓取新闻网页内容进行分析
3. **AI对话**: 支持与AI进行新闻深度讨论
4. **本地部署**: 基于Ollama的本地AI推理
5. **实时更新**: 支持实时天气和新闻数据
6. **用户友好**: 直观的Web界面和交互体验

## 🔮 未来规划

- [ ] 支持更多新闻源
- [ ] 增加新闻情感分析
- [ ] 支持多语言新闻
- [ ] 增加新闻推荐算法
- [ ] 支持新闻订阅功能
- [ ] 增加移动端适配

---

**项目维护者**: AI智能体开发团队  
**最后更新**: 2024年8月4日  
**版本**: v2.0
